<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Web Scraping - Documentación de Alvaro</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Web Scraping";
    var mkdocs_page_input_path = "data_science/web_scraping.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Documentación de Alvaro</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Trabajo</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../smart_cities/">Smart Cities</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../uma/">Universidad de Málaga</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../fiware/">FIWARE</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../calidad_aire/">Calidad del Aire</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../video/">Video</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../espacios_digitales/">Espacios Digitales</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Personal</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="#">Hi-Fi</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../hifi/general/">General</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../hifi/lossless/">Lossless</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../hifi/linux-audiofilo/">Linux Audiofilo</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../hifi/darkvoice/">Darkvoice 336SE</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../hifi/r1-zenith/">IMR R1 Zenith</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../hifi/r2-aten/">IMR R2 Aten</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../hifi/review-songs/">Review Songs</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../hifi/tidal-albums/">Tidal Albums</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Programación</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../programming/atom/">Atom</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../programming/emmet/">Emmet</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../programming/git/">Git</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../programming/html-css/">HTML/CSS</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../programming/javascript/">JavaScript</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../programming/mongodb/">MongoDB</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../programming/mysql/">MySQL</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../programming/postgresql/">PostgreSQL</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../programming/python/">Python</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Ruby</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../programming/ruby/general/">General</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../programming/ruby/rails/">Rails</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../programming/ruby/rspec/">RSpec</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../programming/static-site-generators/">Static Site Generators</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../programming/sqlite/">SQLite</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../programming/vim/">Vim</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../programming/vscode/">Visual Studio Code</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">APIs</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../programming/api/tidal-api/">Tidal API</a>
                </li>
    </ul>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="#">Data Science</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../general/">General</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../cursos/">Cursos</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../python/">Python</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../forecasting/">Forecasting</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../nlp/">Natural Language Proccessing</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../R/">R</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="./">Web Scraping</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#enlaces-documentacion-tutoriales-etc">Enlaces, documentación, tutoriales, etc.</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ejemplos-recetas">Ejemplos, recetas</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#jq">jq</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#simplejson">simplejson</a>
    </li>
    </ul>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">AgileVentures</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../agileventures/charity_commission_api/">Charity Commission API</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../backgammon/">Backgammon</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../cerraduras/">Cerraduras</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../detailing/">Detailing</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../docker/">Docker</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../general/">General</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../geojson/">GeoJSON</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../gimp/">Gimp</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../brew/">Homebrew</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../libreoffice/">LibreOffice</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../markdown/">Markdown</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../putty/">PuTTY</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../robocopy/">Robocopy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../ssh/">Ssh</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../tmux/">Tmux</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../ubuntu/">Ubuntu</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../windows10/">Windows 10</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Documentación de Alvaro</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Data Science &raquo;</li>
        
      
        
          <li>Personal &raquo;</li>
        
      
    
    <li>Web Scraping</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="web-scraping">Web Scraping</h1>
<h2 id="enlaces-documentacion-tutoriales-etc">Enlaces, documentación, tutoriales, etc.</h2>
<ul>
<li><a href="https://github.com/ericchiang/pup">pup</a></li>
<li><a href="https://stedolan.github.io/jq/">jq</a><ul>
<li><a href="https://stedolan.github.io/jq/manual/v1.6/">jq 1.6 Manual</a></li>
</ul>
</li>
<li><a href="https://github.com/jeroenjanssens/dsutils/blob/master/scrape">scrape</a>: from book "Data Science at the Command Line"<ul>
<li><a href="https://github.com/jeroenjanssens/dsutils">dsutils</a></li>
</ul>
</li>
<li><a href="https://www.datascienceatthecommandline.com/">Data Science at the Command Line</a><ul>
<li><a href="https://github.com/jeroenjanssens/data-science-at-the-command-line">GitHub repo</a></li>
<li><a href="https://github.com/datasciencetoolbox/datasciencetoolbox">Data Science Toolbox</a></li>
<li><a href="https://hub.docker.com/repository/docker/datasciencetoolbox/dsatcl2e">datasciencetoolbox/dsatcl2e (Docker image)</a></li>
</ul>
</li>
<li><a href="https://kevinmarsh.com/2014/11/12/web-scraping-with-pup-and-jq.html">Web Scraping with pup and jq</a></li>
<li><a href="https://github.com/Inist-CNRS/node-xml2json-command">xml2json command</a></li>
<li><a href="https://dev.to/bdmorin/web-scraping-lunch-and-learn-184j">Web Scraping Lunch and Learn</a>: scrapy, beautiful soup, pup, jq</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Learn/CSS/Building_blocks/Selectors">CSS selectors</a></li>
<li><a href="https://medium.com/tech-explained/top-15-python-packages-you-must-try-c6a877ed3cd0">Top 15 Python Packages You Must Try</a>: Dash, Pillow, JmesPath, simplejson</li>
<li><a href="https://goessner.net/articles/JsonPath/">JSONPath - XPath for JSON</a><ul>
<li><a href="https://github.com/h2non/jsonpath-ng">Python JSONPath Next-Generation</a></li>
<li><a href="https://pypi.org/project/jsonpath-ng/">jsonpath-ng</a></li>
</ul>
</li>
<li><a href="https://jmespath.org/">JMESPath</a><ul>
<li><a href="https://pypi.org/project/jmespath/">JMESPath - PyPi page</a></li>
<li><a href="https://github.com/jmespath/jmespath.py">JMESPath - GitHub page</a></li>
</ul>
</li>
<li><a href="https://levelup.gitconnected.com/json-queries-give-your-users-jmespath-power-ef8ab0d38553">JSON Queries? Empower your users with JMESPath!</a></li>
<li><a href="https://github.com/simplejson/simplejson">simplejson</a><ul>
<li><a href="https://simplejson.readthedocs.io/">simplejson - Readthedocs page</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="ejemplos-recetas">Ejemplos, recetas</h2>
<pre><code class="language-bash"># Usa scrape, xml2json y jq
curl &quot;http://clojurescript.net/&quot; | scrape -be '//body/script' | xml2json | jq '.html.body.script[].src
</code></pre>
<p>wget fetches the HTML code from BBC, which is then normalized by hxnormalize to improve digestability by hxselect (both installed on Ubuntu by sudo apt-get install html-xml-utils), which then extracts the part of the code being identified by the CSS selector. Lynx finally turns the code into a layouted text that you would see in a browser.</p>
<pre><code class="language-bash">~&gt; echo &quot;http://www.bbc.com&quot; |
   wget -O- -i- | 
   hxnormalize -x | 
   hxselect -i &quot;div.most_popular_content&quot; |  
   lynx -stdin -dump &gt; theMostPoupularInNews
</code></pre>
<pre><code class="language-bash">
</code></pre>
<hr />
<h2 id="jq">jq</h2>
<ul>
<li><a href="https://e.printstacktrace.blog/how-to-convert-json-to-csv-from-the-command-line/">How to convert JSON to CSV from the command-line?</a><ul>
<li><a href="https://e.printstacktrace.blog/jq-cookbook/">jq cookbook</a></li>
<li><a href="https://www.youtube.com/c/eprintstacktrace/search?query=jq">jq YouTube videos</a></li>
</ul>
</li>
<li><a href="https://www.freecodecamp.org/news/how-to-transform-json-to-csv-using-jq-in-the-command-line-4fa7939558bf/">How to transform JSON to CSV using jq in the command line</a></li>
<li><a href="https://remysharp.com/drafts/jq-recipes">jq recipes</a></li>
<li><a href="https://jqterm.com/">jqTerm</a></li>
</ul>
<p>Do something like this:</p>
<pre><code class="language-bash">cat file.json | jq -c '.[] | {&quot;index&quot;: {&quot;_index&quot;: &quot;bookmarks&quot;, &quot;_type&quot;: &quot;bookmark&quot;, &quot;_id&quot;: .id}}, .' | curl -XPOST localhost:9200/_bulk --data-binary @-
</code></pre>
<p>We’re taking the file file.json and piping its contents to jq first with the -c flag to construct compact output. Here’s the nugget: We’re taking advantage of the fact that jq can construct not only one but multiple objects per line of input. For each line, we’re creating the control JSON Elasticsearch needs (with the ID from our original object) and creating a second line that is just our original JSON object (.).</p>
<p>Para transformar un json en csv usando jq hay que usar la orden <code>@csv</code> al final del pipeline. Hay que generar la primera fila con los nombres de las columnas y las filas siguientes, únicamente con los valores. La orden <code>@csv</code> procesa elementos individuales, no un array de elementos. Cada elemento tiene que ser un array de valores. Hay que generar, por tanto, un primer array con los nombres de las columnas y después, un array de valores por cada elemento (por cada linea del csv). Para generar el array con los nombres de las columnas hay que usar <code>(first | keys_unsorted)</code>. La orden <code>first</code> se queda con el primer elemento. La orden <code>keys_unsorted</code> se queda únicamente con las claves, sin ordenar alfabéticamente (en el mismo orden que aparecen en el objeto json). Para generar la secuencia de arrays de valores, un array por cada objeto json, hay que usar <code>map([to_entries[] | .value]) | .[]</code>. La función <code>map</code> espera un array de objetos y aplica el filtro pasado como parámetro a cada uno de los objetos del array, generando un array resultado. La orden <code>to_entries[]</code> transforma cada clave en un objeto {key: clave, value: valor}, eso se pasa a <code>.value</code> para quedarse con el valor y se empaqueta todo en un array con <code>[]</code>. Se genera, por tanto, un array de arrays que desempaqueta después con <code>.[]</code>. Juntandolo todo, sería:</p>
<pre><code>jq -r '(first | keys_unsorted) as $keys | map([to_entries[] | .value]) as $rows | $keys, $rows[] | @csv'
</code></pre>
<p>Una versión más compacta de lo anterior sería:</p>
<pre><code>jq -r '(first | keys_unsorted), (map([.[]]) | .[]) | @csv' archivo.json &gt; archivo.csv
</code></pre>
<p>Para que la orden anterior funcione, el archivo json tiene que ser un array de objetos json.</p>
<p>El filtro <code>to_entries[] | .value</code> es equivalente a <code>.[]</code>. Cuando se aplica a un objeto, el filtro <code>.[]</code> devuelve los valores del objeto separados por comas. El filtro <code>[.[]]</code> genera un array con los valores del objeto</p>
<hr />
<h2 id="simplejson">simplejson</h2>
<p>What’s wrong with the native json module in Python? Nothing! In fact, Python'sjson is simplejson. Meaning, Python takes a version of simplejson and incorporates it into each release. But usingsimplejson has some advantages:</p>
<ul>
<li>It works on more Python versions.</li>
<li>It is updated more frequently than the version shipped with Python.</li>
<li>It has (optional) parts that are written in C, making it very fast.</li>
</ul>
<p>Due to these facts, something you will often see in scripts that work with JSON is this:</p>
<pre><code class="language-python">try:
  import simplejson as json
except ImportError:
  import json
</code></pre>
<p>I would just use the defaultjson, unless you specifically need:</p>
<ul>
<li>raw speed</li>
<li>something that is not in the standard library</li>
</ul>
<p>Simplejson can be a lot faster than json, because it has some critical parts implemented in C. This speed will not be of interest to you, unless you are working with millions of JSON files. In that case, also check out UltraJSON, which is supposed to be even faster because almost all of it is written in C. </p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../agileventures/charity_commission_api/" class="btn btn-neutral float-right" title="Charity Commission API">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../R/" class="btn btn-neutral" title="R"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../R/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../agileventures/charity_commission_api/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
