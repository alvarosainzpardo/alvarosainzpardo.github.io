<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Ssh - Documentación de Alvaro</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="..">Documentación de Alvaro</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="..">Home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Trabajo <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../video/">Video</a>
</li>
                            
<li >
    <a href="../espacios_digitales/">Espacios Digitales</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Personal <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
  <li class="dropdown-submenu">
    <a href="#">Data Science</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../data_science/general/">General</a>
</li>
            
<li >
    <a href="../data_science/cursos/">Cursos</a>
</li>
            
<li >
    <a href="../data_science/python/">Python</a>
</li>
            
<li >
    <a href="../data_science/R/">R</a>
</li>
    </ul>
  </li>
                            
<li class="active">
    <a href="./">Ssh</a>
</li>
                            
<li >
    <a href="../vim/">Vim</a>
</li>
                            
<li >
    <a href="../git/">Git</a>
</li>
                            
<li >
    <a href="../markdown/">Markdown</a>
</li>
                            
<li >
    <a href="../brew/">Homebrew</a>
</li>
                            
<li >
    <a href="../robocopy/">Robocopy</a>
</li>
                            
<li >
    <a href="../lossless/">Lossless</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../data_science/R/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../vim/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#guia-rapida-de-ssh">Guia rápida de ssh</a></li>
            <li><a href="#enlaces-documentacion">Enlaces, documentación</a></li>
            <li><a href="#usar-ssh-detras-de-un-proxy">Usar ssh detrás de un proxy</a></li>
            <li><a href="#autenticacion-con-clave-privada-archivos-pem">Autenticación con clave privada (archivos .pem)</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="guia-rapida-de-ssh">Guia rápida de ssh</h1>
<hr />
<h2 id="enlaces-documentacion">Enlaces, documentación</h2>
<ul>
<li><a href="http://www.perkin.org.uk/posts/ssh-via-http-proxy-in-osx.html">SSH via HTTP proxy in OSX</a></li>
<li><a href="https://stackoverflow.com/questions/19161960/connect-with-ssh-through-a-proxy">Connect with SSH through a proxy</a></li>
<li><a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstancesLinux.html">Connecting to Your Linux Instance Using SSH</a></li>
</ul>
<hr />
<h2 id="usar-ssh-detras-de-un-proxy">Usar ssh detrás de un proxy</h2>
<p>El comando para realizar una conexión ssh a través de un servidor proxy es:</p>
<pre><code class="bash">$ ssh &lt;user&gt;@&lt;host&gt; -o &quot;ProxyCommand=nc -X connect -x &lt;proxyhost&gt;:&lt;proxyport&gt; %h %p&quot;
</code></pre>

<p>Por ejemplo:</p>
<pre><code class="bash">$ ssh asainz@sulaco.ttcloud.net -o &quot;ProxyCommand=nc -X connect -x proxyinternet.tesa:8080 %h %p&quot;
</code></pre>

<p>Para que este comando funcione, el servidor proxy tiene que aceptar el método de conexión <code>CONNECT</code> y el comando <code>nc</code> tiene que estar instalado en el sistema.</p>
<p>Para usar un proxy socks5 el comando es:</p>
<pre><code class="bash">$ ssh &lt;user&gt;@&lt;host&gt; -o &quot;ProxyCommand=nc -X 5 -x &lt;proxyhost&gt;:&lt;proxyport&gt; %h %p&quot;
</code></pre>

<p>Y para usar un proxy socks4 se utilizaría la opción <code>-X 4</code>.</p>
<p>Para no tener que teclear el comando cada vez que se utiliza el cliente ssh se puede configurar esta opción en el archivo de configuración de ssh, <code>~/.ssh/config</code>.</p>
<p>Se puede añadir la opción para todos los hosts:</p>
<pre><code>Host *
    ProxyCommand          nc -X connect -x proxyhost:proxyport %h %p
    ServerAliveInterval   10
</code></pre>
<p>O para un host en concreto:</p>
<pre><code>Host sulaco.ttcloud.net
    ProxyCommand          nc -X connect -x proxyhost:proxyport %h %p
    ServerAliveInterval   10
</code></pre>
<p>La opción <code>ServerAliveInterval</code>es para que el proxy no desconecte después de un periodo de inactividad.</p>
<h3 id="nc-en-mac-osx">nc en Mac OSX</h3>
<p>La versión de nc de OSX tiene un problema de compatibilidad con los proxies http. No es compatible con proxies que utilizan HTTP 1.1, sólo es compatible con HTTP 1.0. El proxy de Telefónica utiliza HTTP 1.1, por lo que no se puede usar nc. Una alternativa que funciona perfectamente es <a href="https://nmap.org/ncat/">ncat</a>, que forma parte del paquete <a href="https://nmap.org/">nmap</a>.</p>
<p>La opción para utilizar ncat en el archivo <code>~/.ssh/config</code> es:</p>
<pre><code>Host *
    ProxyCommand          ncat --proxy proxyhost:proxyport --proxy-auth user:passwd %h %p
</code></pre>
<hr />
<h2 id="autenticacion-con-clave-privada-archivos-pem">Autenticación con clave privada (archivos .pem)</h2>
<p>Para conectarse a máquinas virtuales de Amazon y Fiware, hay que utilizar la autenticación con clave privada (archivos .pem)</p>
<h3 id="configuracion-del-cliente">Configuración del cliente</h3>
<ul>
<li><a href="https://michaelheap.com/ssh-config-files/">SSH Config Files</a></li>
</ul>
<p>La opción para conectarse a un servidor que requiere autenticación por clave privada es <code>-i &lt;archivo.pem&gt;</code>:</p>
<pre><code class="bash">$ ssh &lt;user&gt;@&lt;host&gt; -i &lt;path/file.pem&gt;
</code></pre>

<p>El archivo .pem tiene que tener permisos de lectura únicamente para el propietario del archivo (<code>chmod 400 &lt;archivo.pem&gt;</code>).</p>
<p>La configuracíón equivalente en el archivo <code>~/.ssh/config</code>sería:</p>
<pre><code>Host &lt;host&gt;
    IdentityFile &lt;path/file.pem&gt;
</code></pre>
<h3 id="configuracion-del-servidor">Configuración del servidor</h3>
<p>Cuando el servidor ssh está configurado para aceptar únicamente conexiones sin password mediante clave privada, en el directorio <code>.ssh</code> del usuario hay que copiar el archivo <code>authorized_keys</code> que se haya generado para el usuario por defecto de la maquina virtual.</p>
<p>El directorio <code>.ssh</code> tiene que tener permisos de lectura/escritura/ejecución sólo para el propietario (<code>chmod 700 ~/.ssh</code>) y el archivo <code>authorized_keys</code> permisos de lectura/escritura únicamente para el propietario (<code>chmod 600 ~/.ssh/authorized_keys</code>).</p>
<p>Además, hay que comprobar que el el archivo de configuración del servidor sshd (<code>/etc/ssh/sshd_config</code>) esté autorizado el acceso por ssh para el nuevo usuario. Esto hay que hacerlo <strong>obligatoriamente en las máquinas virtuales Ubuntu de Fiware</strong>.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
